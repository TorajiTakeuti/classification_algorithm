import numpy as np
import sys
from decisionTree import DecisionTree

def ask_question(prompt, options=None):
    """è³ªå•ã‚’ã—ã¦å…¥åŠ›ã‚’æ•°å€¤ã§è¿”ã™ã€‚optionsãŒã‚ã‚‹å ´åˆã¯é¸æŠè‚¢ã‹ã‚‰é¸ã°ã›ã‚‹ã€‚"""
    if options:
        opt_str = " / ".join([f"{k}:{v}" for v, k in options.items()])
        answer = input(f"{prompt}\n({opt_str}) >> ").lower()
        if answer in options:
            return options[answer]
    else:
        # Yes/Noå½¢å¼
        response_map = {"ã¯ã„": 1, "y": 1, "yes": 1, "ã„ã„ãˆ": 0, "n": 0, "no": 0}
        answer = input(f"{prompt} (ã¯ã„/ã„ã„ãˆ) >> ").lower()
        if answer in response_map:
            return response_map[answer]
    
    print(f"ã€Œ{answer}ã€ã¯æ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚çµ‚äº†ã—ã¾ã™ã€‚")
    sys.exit()

# --- 1. ç‰¹å¾´é‡ã®å®šç¾©ï¼ˆæ•°å€¤ã«å¤‰æ›ã™ã‚‹ãŸã‚ã®è¾æ›¸ï¼‰ ---
color_map = {"èµ¤": 0, "èŒ¶": 1, "ç™½": 2}
shape_map = {"å††å½¢": 0, "é˜å½¢": 1, "å¹³ã‚‰": 2}

# --- 2. è¨“ç·´ãƒ‡ãƒ¼ã‚¿ï¼ˆAIã®æ•™ç§‘æ›¸ï¼‰ ---
# ãƒ‡ãƒ¼ã‚¿æ§‹é€ : [ã‚«ã‚µãŒæ»‘ã‚‰ã‹ã‹, åŒ‚ã„ãŒã‚ã‚‹ã‹, è‰²(0:èµ¤, 1:èŒ¶, 2:ç™½), å½¢(0:å††, 1:é˜, 2:å¹³)]
X_train = np.array([
    [0, 0, 1, 0], # æ»‘ã‚‰ã‹ã§ãªã„, åŒ‚ã„ãªã—, èŒ¶, å††å½¢ -> é£Ÿç”¨
    [1, 1, 0, 1], # æ»‘ã‚‰ã‹, åŒ‚ã„ã‚ã‚Š, èµ¤, é˜å½¢ -> æ¯’
    [0, 1, 0, 0], # æ»‘ã‚‰ã‹ã§ãªã„, åŒ‚ã„ã‚ã‚Š, èµ¤, å††å½¢ -> æ¯’
    [1, 0, 1, 2], # æ»‘ã‚‰ã‹, åŒ‚ã„ãªã—, èŒ¶, å¹³ã‚‰ -> é£Ÿç”¨
    [0, 0, 2, 0], # æ»‘ã‚‰ã‹ã§ãªã„, åŒ‚ã„ãªã—, ç™½, å††å½¢ -> é£Ÿç”¨
    [1, 1, 2, 1], # æ»‘ã‚‰ã‹, åŒ‚ã„ã‚ã‚Š, ç™½, é˜å½¢ -> æ¯’
])
y_train = np.array([0, 1, 1, 0, 0, 1]) # 0:é£Ÿç”¨, 1:æ¯’

# --- 3. å­¦ç¿’ ---
model = DecisionTree(max_depth=5)
model.fit(X_train, y_train)

print("--- AIã®å­¦ç¿’ãŒå®Œäº†ã—ã¾ã—ãŸï¼ˆè‰²ã¨å½¢ã«å¯¾å¿œï¼‰ ---")

# --- 4. é¡§å®¢ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼‰ã‹ã‚‰ã®å…¥åŠ› ---
print("\né‘‘å®šã—ãŸã„ã‚­ãƒã‚³ã®ç‰¹å¾´ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚")
v1 = ask_question("ã‚«ã‚µã¯æ»‘ã‚‰ã‹ã§ã™ã‹ï¼Ÿ")
v2 = ask_question("åŒ‚ã„ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ")
v3 = ask_question("è‰²ã¯ä½•è‰²ã§ã™ã‹ï¼Ÿ", color_map)
v4 = ask_question("å½¢ã¯ã©ã†ã§ã™ã‹ï¼Ÿ", shape_map)

# äºˆæ¸¬
test_mushroom = np.array([v1, v2, v3, v4])
result = model.predict(test_mushroom)

# --- 5. çµæœè¡¨ç¤º ---
print("\n--- AIã«ã‚ˆã‚‹é‘‘å®šçµæœ ---")
print(f"çµæœ: {'âš ï¸ æ¯’ã‚­ãƒã‚³ã®å¯èƒ½æ€§ãŒé«˜ã„ã§ã™ï¼' if result == 1 else 'ğŸ„ é£Ÿç”¨ã‚­ãƒã‚³ã¨æ€ã‚ã‚Œã¾ã™ã€‚'}")